<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic Signal LLM</title>
    <link rel="stylesheet" href="style.css?v=2.1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div id="app-container">
        <aside id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üß†</span>
                    <div>
                        <h1>SEMANTIC<span class="highlight">SIGNAL</span> LLM</h1>
                        <div class="subtitle">LLM-POWERED NEURAL ENGINE</div>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-target="tab-overview">
                    <span class="icon">üìä</span> Overview
                </a>
                <a href="#" class="nav-item" data-target="tab-brain">
                    <span class="icon">üï∏Ô∏è</span> Brain Activity
                </a>
                <a href="#" class="nav-item" data-target="tab-prompt">
                    <span class="icon">üí¨</span> Last Prompt
                </a>
                <a href="#" class="nav-item" data-target="tab-response">
                    <span class="icon">üìù</span> Last Response
                </a>
                <a href="#" class="nav-item" data-target="tab-stats">
                    <span class="icon">üìä</span> Statistics
                </a>
                <a href="#" class="nav-item" data-target="tab-news">
                    <span class="icon">üì∞</span> Latest News
                </a>
                <a href="#" class="nav-item" data-target="tab-market">
                    <span class="icon">üìà</span> Market Data
                </a>
                <a href="#" class="nav-item" data-target="tab-memory">
                    <span class="icon">üíæ</span> Memory Bank
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span id="connection-status">Connecting...</span>
                </div>
                <!-- Hidden legacy fields for main.js compatibility -->
                <div id="status-panel" style="display: none;">
                    <span id="brain-state-indicator">ACTIVE</span>
                    <strong id="trend-val">--</strong>
                    <strong id="conf-val">--</strong>
                    <strong id="action-val">--</strong>
                    <ul id="rules-list"></ul>
                </div>
                <div class="next-update">
                    <span class="label">Next Analysis</span>
                    <span id="next-analysis" class="value">--:--</span>
                </div>
            </div>
        </aside>

        <main id="content-area">
            <!-- Tab: Overview -->
            <div id="tab-overview" class="tab-content active">
                <header class="tab-header">
                    <h2>Live Dashboard</h2>
                    <span id="last-updated" style="font-size: 12px; color: var(--text-muted);">Updated: --</span>
                </header>

                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="label">Market Trend</div>
                        <div class="value" id="overview-trend">--</div>
                    </div>
                    <div class="kpi-card">
                        <div class="label">Confidence</div>
                        <div class="value highlight" id="overview-conf">--%</div>
                        <div class="sub-label" id="overview-action">WAITING</div>
                    </div>
                    <div class="kpi-card">
                        <div class="label">Active Rules</div>
                        <div class="value" id="overview-rules-count">0</div>
                        <div class="sub-label" id="overview-rules-hint" style="font-size: 10px;">No rules learned yet</div>
                    </div>
                    <div class="kpi-card">
                        <div class="label">Session Cost</div>
                        <div class="value" id="overview-cost">$0.00</div>
                        <div style="position: absolute; top: 15px; right: 15px; display: flex; gap: 5px;">
                            <button class="icon-btn-xs" onclick="refreshCosts()" title="Refresh">‚Üª</button>
                            <button class="icon-btn-xs" onclick="confirmResetCosts()" title="Reset" style="color: var(--accent-danger);">üóë</button>
                        </div>
                    </div>
                </div>

                <section id="panel-performance" class="panel full-height-panel">
                    <div class="panel-header">
                        <h3>Performance Metrics</h3>
                        <div class="controls">
                            <span id="stats-summary" style="margin-right: 15px; font-size: 0.8em; color: var(--text-muted);">Loading stats...</span>
                            <button onclick="updatePerformance()">Refresh</button>
                        </div>
                    </div>
                    <div id="performance-chart" class="chart-container"></div>
                </section>
            </div>

            <!-- Tab: Brain Activity -->
            <div id="tab-brain" class="tab-content">
                <header class="tab-header">
                    <h2>Neural Network State</h2>
                </header>

                <div class="stack-layout">
                    <section id="panel-synapses" class="panel large-panel">
                        <div class="panel-header">
                            <h3>Synaptic Pathways</h3>
                            <div class="legend">
                                <span class="dot buy"></span> BUY
                                <span class="dot close"></span> CLOSE
                                <span class="dot update"></span> UPDATE
                            </div>
                        </div>
                        <div id="synapse-network" class="network-container"></div>
                    </section>
                    
                    <section id="panel-visuals" class="panel visual-panel">
                        <div class="panel-header">
                            <h3>Visual Cortex Input</h3>
                            <div class="controls panel-toolbar">
                                <button class="toolbar-btn" onclick="updateVisuals()" title="Refresh">‚Üª</button>
                                <button class="toolbar-btn" onclick="togglePanelMinimize('panel-visuals')" title="Minimize">‚àí</button>
                                <button class="toolbar-btn" onclick="openLightbox(document.getElementById('analysis-chart').src)" title="Fullscreen">‚õ∂</button>
                            </div>
                        </div>
                        <div id="visual-container" class="visual-box">
                            <img id="analysis-chart" src="" alt="No chart generated" style="display: none;">
                            <span id="no-chart-msg">No visual data available</span>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Tab: Last Prompt -->
            <div id="tab-prompt" class="tab-content">
                <header class="tab-header">
                    <h2>Last Prompt</h2>
                    <button class="btn-primary" onclick="updatePromptTab()">Refresh</button>
                </header>
                <section class="panel full-height-panel">
                    <div class="panel-header">
                        <h3>Trading Context Sent to LLM</h3>
                        <div class="controls">
                            <span id="prompt-meta" class="meta-info"></span>
                            <button onclick="copyPromptContent()">üìã Copy</button>
                        </div>
                    </div>
                    <div id="prompt-viewer" class="discord-content">Loading...</div>
                </section>
            </div>

            <!-- Tab: Last Response -->
            <div id="tab-response" class="tab-content">
                <header class="tab-header">
                    <h2>Last Response</h2>
                    <button class="btn-primary" onclick="updateResponseTab()">Refresh</button>
                </header>
                <section class="panel full-height-panel">
                    <div class="panel-header">
                        <h3>LLM Analysis Output</h3>
                        <div class="controls">
                            <span id="response-meta" class="meta-info"></span>
                            <button onclick="copyResponseContent()">üìã Copy</button>
                        </div>
                    </div>
                    <div id="response-viewer" class="discord-content">Loading...</div>
                </section>
            </div>

            <!-- Tab: Statistics -->
            <div id="tab-stats" class="tab-content">
                <header class="tab-header">
                    <h2>Trading Statistics</h2>
                    <button class="btn-primary" onclick="updateStatisticsPanel()">Refresh</button>
                </header>
                <div id="statistics-content">
                    <div class="empty-state">Loading statistics...</div>
                </div>
            </div>

            <!-- Tab: Latest News -->
            <div id="tab-news" class="tab-content">
                <header class="tab-header">
                    <h2>Latest Crypto News</h2>
                    <button class="btn-primary" onclick="updateNewsPanel()">Refresh</button>
                </header>
                <div id="news-content">
                    <div class="empty-state">Loading news...</div>
                </div>
            </div>

            <!-- Tab: Market Data -->
            <div id="tab-market" class="tab-content">
                <header class="tab-header">
                    <h2>Active Market Position</h2>
                    <button class="btn-primary" onclick="updatePosition()">Force Refresh</button>
                </header>
                
                <section id="panel-position" class="panel">
                    <div class="panel-header">
                        <h3>Position Details</h3>
                    </div>
                    <div id="position-content" class="position-details-container">
                        <div class="no-position">
                            <span class="no-position-icon">üì≠</span>
                            <span>No active positions</span>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tab: Memory Bank -->
            <div id="tab-memory" class="tab-content">
                <header class="tab-header">
                    <h2>Vector Experience Database</h2>
                    <button class="btn-primary" onclick="updateVectors()">Sync Database</button>
                </header>

                <section id="panel-vectors" class="panel full-height-panel">
                    <div id="vector-content">
                        <div class="empty-state">Loading vector database...</div>
                    </div>
                </section>
            </div>

        </main>
    </div>

    <script type="module" src="main.js?v=3.1"></script>
    
    <script>
        // Sync hidden status fields to visible UI (except costs which are handled by main.js directly)
        function syncStatus() {
            try {
                const trend = document.getElementById('trend-val').textContent;
                const trendEl = document.getElementById('overview-trend');
                if(trendEl && trend !== '--') {
                    trendEl.textContent = trend;
                    trendEl.className = 'value ' + (trend === 'BULLISH' ? 'start-green' : (trend === 'BEARISH' ? 'start-red' : ''));
                }

                const conf = document.getElementById('conf-val').textContent;
                if (conf !== '--') document.getElementById('overview-conf').textContent = conf;

                const act = document.getElementById('action-val').textContent;
                if (act !== '--') document.getElementById('overview-action').textContent = act;

                const rulesList = document.getElementById('rules-list');
                const count = rulesList ? rulesList.getElementsByTagName('li').length : 0;
                const firstText = rulesList?.firstElementChild?.textContent || "";
                const realCount = (firstText.includes('Loading') || firstText.includes('No rules')) ? 0 : count;
                document.getElementById('overview-rules-count').textContent = realCount;
                const hint = document.getElementById('overview-rules-hint');
                if (hint) hint.style.display = realCount > 0 ? 'none' : 'block';

            } catch(e) { /* ignore sync errors */ }
        }
        setInterval(syncStatus, 1000);
    </script>
</body>
</html>